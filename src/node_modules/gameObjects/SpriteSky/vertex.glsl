uniform float progress;
uniform float mapFrames;
uniform float usedFramesPercentage;
uniform sampler2D mapTexture;

varying vec4 vColor;

void main() {
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  float quantizedProgress = floor(progress * mapFrames) / mapFrames;
  vec2 modifiedUV = uv;
  modifiedUV.y += quantizedProgress * usedFramesPercentage + (1.0 - usedFramesPercentage);
  vec4 colorA = texture2D(mapTexture, modifiedUV);
  float quantizedProgress2 = floor((progress + 1.0 / mapFrames) * mapFrames) / mapFrames;
  modifiedUV = uv;
  modifiedUV.y += mod(quantizedProgress2, 1.0) * usedFramesPercentage + (1.0 - usedFramesPercentage);
  vec4 colorB = texture2D(mapTexture, modifiedUV);
  vColor = mix(colorA, colorB, (progress - quantizedProgress) * mapFrames);
}

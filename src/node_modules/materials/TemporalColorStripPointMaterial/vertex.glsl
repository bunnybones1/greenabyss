attribute float size;
uniform float scale;

uniform float progress;
uniform float halfPixel;
uniform float mapFrames;
uniform float usedFramesPercentage;

varying vec2 vUv;
varying float vOffsetY;
varying float vOffsetY2;
varying float vMix;
varying float vScale;

void main() {
	#include <begin_vertex>
	#include <project_vertex>
	gl_PointSize = size * ( scale / - mvPosition.z );
	float frameRatio = 1.0 / mapFrames;
	float remainder = mod(progress, frameRatio);
	float quantizedProgress = progress - remainder;
	float inverseUsedFramesPercentage = 1.0 - usedFramesPercentage;
	vOffsetY = quantizedProgress * usedFramesPercentage + inverseUsedFramesPercentage + halfPixel;
	float quantizedProgress2 = quantizedProgress + frameRatio;
	vOffsetY2 = mod(quantizedProgress2, 1.0) * usedFramesPercentage + inverseUsedFramesPercentage + halfPixel;
	vMix = (progress - quantizedProgress) * mapFrames;
	vScale = size * 0.75 + 0.25;
}
